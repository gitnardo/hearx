/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { coerceArray } from './coerceArray';
import { DEFAULT_ID_KEY } from './defaultIDKey';
import { distinctUntilChanged, map } from 'rxjs/operators';
import { isArray } from './isArray';
import { isFunction } from './isFunction';
import { isEmpty } from './isEmpty';
// @internal
/**
 * @template T
 * @param {?} collection
 * @param {?} idsOrPredicate
 * @param {?} idKey
 * @return {?}
 */
export function find(collection, idsOrPredicate, idKey) {
    /** @type {?} */
    const result = [];
    if (isFunction(idsOrPredicate)) {
        for (const entity of collection) {
            if (idsOrPredicate(entity) === true) {
                result.push(entity);
            }
        }
    }
    else {
        /** @type {?} */
        const toSet = coerceArray(idsOrPredicate).reduce((/**
         * @param {?} acc
         * @param {?} current
         * @return {?}
         */
        (acc, current) => acc.add(current)), new Set());
        for (const entity of collection) {
            if (toSet.has(entity[idKey])) {
                result.push(entity);
            }
        }
    }
    return result;
}
// @internal
/**
 * @template T
 * @return {?}
 */
export function distinctUntilArrayItemChanged() {
    return distinctUntilChanged((/**
     * @param {?} prevCollection
     * @param {?} currentCollection
     * @return {?}
     */
    (prevCollection, currentCollection) => {
        if (prevCollection === currentCollection) {
            return true;
        }
        if (isArray(prevCollection) === false || isArray(currentCollection) === false) {
            return false;
        }
        if (isEmpty(prevCollection) && isEmpty(currentCollection)) {
            return true;
        }
        // if item is new in the current collection but not exist in the prev collection
        /** @type {?} */
        const hasNewItem = hasChange(currentCollection, prevCollection);
        if (hasNewItem) {
            return false;
        }
        /** @type {?} */
        const isOneOfItemReferenceChanged = hasChange(prevCollection, currentCollection);
        // return false means there is a change and we want to call next()
        return isOneOfItemReferenceChanged === false;
    }));
}
// @internal
/**
 * @template T
 * @param {?} first
 * @param {?} second
 * @return {?}
 */
function hasChange(first, second) {
    /** @type {?} */
    const hasChange = second.some((/**
     * @param {?} currentItem
     * @return {?}
     */
    currentItem => {
        /** @type {?} */
        const oldItem = first.find((/**
         * @param {?} prevItem
         * @return {?}
         */
        prevItem => prevItem === currentItem));
        return oldItem === undefined;
    }));
    return hasChange;
}
/**
 * @template T
 * @param {?} idsOrPredicate
 * @param {?=} idKey
 * @return {?}
 */
export function arrayFind(idsOrPredicate, idKey) {
    return (/**
     * @param {?} source
     * @return {?}
     */
    function (source) {
        return source.pipe(map((/**
         * @param {?} collection
         * @return {?}
         */
        (collection) => {
            // which means the user deleted the root entity or set the collection to nil
            if (isArray(collection) === false) {
                return collection;
            }
            return find(collection, idsOrPredicate, idKey || DEFAULT_ID_KEY);
        })), distinctUntilArrayItemChanged(), map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (isArray(value) === false) {
                return value;
            }
            if (isArray(idsOrPredicate) || isFunction(idsOrPredicate)) {
                return value;
            }
            return value[0];
        })));
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJyYXlGaW5kLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGRhdG9yYW1hL2FraXRhLyIsInNvdXJjZXMiOlsic3JjL2FycmF5RmluZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDOzs7Ozs7Ozs7QUFHcEMsTUFBTSxVQUFVLElBQUksQ0FBSSxVQUFlLEVBQUUsY0FBbUMsRUFBRSxLQUFhOztVQUNuRixNQUFNLEdBQUcsRUFBRTtJQUNqQixJQUFJLFVBQVUsQ0FBQyxjQUFjLENBQUMsRUFBRTtRQUM5QixLQUFLLE1BQU0sTUFBTSxJQUFJLFVBQVUsRUFBRTtZQUMvQixJQUFJLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDckI7U0FDRjtLQUNGO1NBQU07O2NBQ0MsS0FBSyxHQUFHLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFNOzs7OztRQUFDLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRS9GLEtBQUssTUFBTSxNQUFNLElBQUksVUFBVSxFQUFFO1lBQy9CLElBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtnQkFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUNyQjtTQUNGO0tBQ0Y7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDOzs7Ozs7QUFHRCxNQUFNLFVBQVUsNkJBQTZCO0lBQzNDLE9BQU8sb0JBQW9COzs7OztJQUFDLENBQUMsY0FBbUIsRUFBRSxpQkFBc0IsRUFBRSxFQUFFO1FBQzFFLElBQUksY0FBYyxLQUFLLGlCQUFpQixFQUFFO1lBQ3hDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxLQUFLLElBQUksT0FBTyxDQUFDLGlCQUFpQixDQUFDLEtBQUssS0FBSyxFQUFFO1lBQzdFLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsaUJBQWlCLENBQUMsRUFBRTtZQUN6RCxPQUFPLElBQUksQ0FBQztTQUNiOzs7Y0FHSyxVQUFVLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixFQUFFLGNBQWMsQ0FBQztRQUUvRCxJQUFJLFVBQVUsRUFBRTtZQUNkLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7O2NBRUssMkJBQTJCLEdBQUcsU0FBUyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQztRQUVoRixrRUFBa0U7UUFDbEUsT0FBTywyQkFBMkIsS0FBSyxLQUFLLENBQUM7SUFDL0MsQ0FBQyxFQUFDLENBQUM7QUFDTCxDQUFDOzs7Ozs7OztBQUdELFNBQVMsU0FBUyxDQUFJLEtBQVUsRUFBRSxNQUFXOztVQUNyQyxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUk7Ozs7SUFBQyxXQUFXLENBQUMsRUFBRTs7Y0FDcEMsT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJOzs7O1FBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEtBQUssV0FBVyxFQUFDO1FBQ2hFLE9BQU8sT0FBTyxLQUFLLFNBQVMsQ0FBQztJQUMvQixDQUFDLEVBQUM7SUFFRixPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDOzs7Ozs7O0FBNEJELE1BQU0sVUFBVSxTQUFTLENBQUksY0FBNEMsRUFBRSxLQUFjO0lBQ3ZGOzs7O0lBQU8sVUFBUyxNQUF1QjtRQUNyQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQ2hCLEdBQUc7Ozs7UUFBQyxDQUFDLFVBQWtDLEVBQUUsRUFBRTtZQUN6Qyw0RUFBNEU7WUFDNUUsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssS0FBSyxFQUFFO2dCQUNqQyxPQUFPLFVBQVUsQ0FBQzthQUNuQjtZQUNELE9BQU8sSUFBSSxDQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUUsS0FBSyxJQUFJLGNBQWMsQ0FBQyxDQUFDO1FBQ25FLENBQUMsRUFBQyxFQUNGLDZCQUE2QixFQUFFLEVBQy9CLEdBQUc7Ozs7UUFBQyxLQUFLLENBQUMsRUFBRTtZQUNWLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEtBQUssRUFBRTtnQkFDNUIsT0FBTyxLQUFLLENBQUM7YUFDZDtZQUVELElBQUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxjQUFjLENBQUMsRUFBRTtnQkFDekQsT0FBTyxLQUFLLENBQUM7YUFDZDtZQUVELE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xCLENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDLEVBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUQsIElEUywgSXRlbVByZWRpY2F0ZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgY29lcmNlQXJyYXkgfSBmcm9tICcuL2NvZXJjZUFycmF5JztcbmltcG9ydCB7IERFRkFVTFRfSURfS0VZIH0gZnJvbSAnLi9kZWZhdWx0SURLZXknO1xuaW1wb3J0IHsgZGlzdGluY3RVbnRpbENoYW5nZWQsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgaXNBcnJheSB9IGZyb20gJy4vaXNBcnJheSc7XG5pbXBvcnQgeyBpc0Z1bmN0aW9uIH0gZnJvbSAnLi9pc0Z1bmN0aW9uJztcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICcuL2lzRW1wdHknO1xuXG4vLyBAaW50ZXJuYWxcbmV4cG9ydCBmdW5jdGlvbiBmaW5kPFQ+KGNvbGxlY3Rpb246IFRbXSwgaWRzT3JQcmVkaWNhdGU6IElEUyB8IEl0ZW1QcmVkaWNhdGUsIGlkS2V5OiBzdHJpbmcpIHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGlmIChpc0Z1bmN0aW9uKGlkc09yUHJlZGljYXRlKSkge1xuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIGNvbGxlY3Rpb24pIHtcbiAgICAgIGlmIChpZHNPclByZWRpY2F0ZShlbnRpdHkpID09PSB0cnVlKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKGVudGl0eSk7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IHRvU2V0ID0gY29lcmNlQXJyYXkoaWRzT3JQcmVkaWNhdGUpLnJlZHVjZSgoYWNjLCBjdXJyZW50KSA9PiBhY2MuYWRkKGN1cnJlbnQpLCBuZXcgU2V0KCkpO1xuXG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgY29sbGVjdGlvbikge1xuICAgICAgaWYgKHRvU2V0LmhhcyhlbnRpdHlbaWRLZXldKSkge1xuICAgICAgICByZXN1bHQucHVzaChlbnRpdHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIEBpbnRlcm5hbFxuZXhwb3J0IGZ1bmN0aW9uIGRpc3RpbmN0VW50aWxBcnJheUl0ZW1DaGFuZ2VkPFQ+KCk6IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbjxUW10+IHtcbiAgcmV0dXJuIGRpc3RpbmN0VW50aWxDaGFuZ2VkKChwcmV2Q29sbGVjdGlvbjogVFtdLCBjdXJyZW50Q29sbGVjdGlvbjogVFtdKSA9PiB7XG4gICAgaWYgKHByZXZDb2xsZWN0aW9uID09PSBjdXJyZW50Q29sbGVjdGlvbikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGlzQXJyYXkocHJldkNvbGxlY3Rpb24pID09PSBmYWxzZSB8fCBpc0FycmF5KGN1cnJlbnRDb2xsZWN0aW9uKSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoaXNFbXB0eShwcmV2Q29sbGVjdGlvbikgJiYgaXNFbXB0eShjdXJyZW50Q29sbGVjdGlvbikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIGlmIGl0ZW0gaXMgbmV3IGluIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24gYnV0IG5vdCBleGlzdCBpbiB0aGUgcHJldiBjb2xsZWN0aW9uXG4gICAgY29uc3QgaGFzTmV3SXRlbSA9IGhhc0NoYW5nZShjdXJyZW50Q29sbGVjdGlvbiwgcHJldkNvbGxlY3Rpb24pO1xuXG4gICAgaWYgKGhhc05ld0l0ZW0pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc09uZU9mSXRlbVJlZmVyZW5jZUNoYW5nZWQgPSBoYXNDaGFuZ2UocHJldkNvbGxlY3Rpb24sIGN1cnJlbnRDb2xsZWN0aW9uKTtcblxuICAgIC8vIHJldHVybiBmYWxzZSBtZWFucyB0aGVyZSBpcyBhIGNoYW5nZSBhbmQgd2Ugd2FudCB0byBjYWxsIG5leHQoKVxuICAgIHJldHVybiBpc09uZU9mSXRlbVJlZmVyZW5jZUNoYW5nZWQgPT09IGZhbHNlO1xuICB9KTtcbn1cblxuLy8gQGludGVybmFsXG5mdW5jdGlvbiBoYXNDaGFuZ2U8VD4oZmlyc3Q6IFRbXSwgc2Vjb25kOiBUW10pIHtcbiAgY29uc3QgaGFzQ2hhbmdlID0gc2Vjb25kLnNvbWUoY3VycmVudEl0ZW0gPT4ge1xuICAgIGNvbnN0IG9sZEl0ZW0gPSBmaXJzdC5maW5kKHByZXZJdGVtID0+IHByZXZJdGVtID09PSBjdXJyZW50SXRlbSk7XG4gICAgcmV0dXJuIG9sZEl0ZW0gPT09IHVuZGVmaW5lZDtcbiAgfSk7XG5cbiAgcmV0dXJuIGhhc0NoYW5nZTtcbn1cblxuLyoqXG4gKiBGaW5kIGl0ZW1zIGluIGEgY29sbGVjdGlvblxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogIHNlbGVjdEVudGl0eSgxLCAnY29tbWVudHMnKS5waXBlKFxuICogICBhcnJheUZpbmQoY29tbWVudCA9PiBjb21tZW50LnRleHQgPSAndGV4dCcpXG4gKiApXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcnJheUZpbmQ8VD4oaWRzOiBJdGVtUHJlZGljYXRlPFQ+LCBpZEtleT86IG5ldmVyKTogKHNvdXJjZTogT2JzZXJ2YWJsZTxUW10+KSA9PiBPYnNlcnZhYmxlPFRbXT47XG4vKipcbiAqIEBleGFtcGxlXG4gKlxuICogc2VsZWN0RW50aXR5KDEsICdjb21tZW50cycpLnBpcGUoXG4gKiAgIGFycmF5RmluZCgzKVxuICogKVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXJyYXlGaW5kPFQ+KGlkczogSUQsIGlkS2V5Pzogc3RyaW5nKTogKHNvdXJjZTogT2JzZXJ2YWJsZTxUW10+KSA9PiBPYnNlcnZhYmxlPFQ+O1xuLyoqXG4gKiBAZXhhbXBsZVxuICpcbiAqIHNlbGVjdEVudGl0eSgxLCAnY29tbWVudHMnKS5waXBlKFxuICogICBhcnJheUZpbmQoWzEsIDIsIDNdKVxuICogKVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXJyYXlGaW5kPFQ+KGlkczogSURbXSwgaWRLZXk/OiBzdHJpbmcpOiAoc291cmNlOiBPYnNlcnZhYmxlPFRbXT4pID0+IE9ic2VydmFibGU8VFtdPjtcbmV4cG9ydCBmdW5jdGlvbiBhcnJheUZpbmQ8VD4oaWRzT3JQcmVkaWNhdGU6IElEW10gfCBJRCB8IEl0ZW1QcmVkaWNhdGU8VD4sIGlkS2V5Pzogc3RyaW5nKTogKHNvdXJjZTogT2JzZXJ2YWJsZTxUW10+KSA9PiBPYnNlcnZhYmxlPFRbXSB8IFQ+IHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHNvdXJjZTogT2JzZXJ2YWJsZTxUW10+KSB7XG4gICAgcmV0dXJuIHNvdXJjZS5waXBlKFxuICAgICAgbWFwKChjb2xsZWN0aW9uOiBUW10gfCB1bmRlZmluZWQgfCBudWxsKSA9PiB7XG4gICAgICAgIC8vIHdoaWNoIG1lYW5zIHRoZSB1c2VyIGRlbGV0ZWQgdGhlIHJvb3QgZW50aXR5IG9yIHNldCB0aGUgY29sbGVjdGlvbiB0byBuaWxcbiAgICAgICAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbmQoY29sbGVjdGlvbiwgaWRzT3JQcmVkaWNhdGUsIGlkS2V5IHx8IERFRkFVTFRfSURfS0VZKTtcbiAgICAgIH0pLFxuICAgICAgZGlzdGluY3RVbnRpbEFycmF5SXRlbUNoYW5nZWQoKSxcbiAgICAgIG1hcCh2YWx1ZSA9PiB7XG4gICAgICAgIGlmIChpc0FycmF5KHZhbHVlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNBcnJheShpZHNPclByZWRpY2F0ZSkgfHwgaXNGdW5jdGlvbihpZHNPclByZWRpY2F0ZSkpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWVbMF07XG4gICAgICB9KVxuICAgICk7XG4gIH07XG59XG4iXX0=