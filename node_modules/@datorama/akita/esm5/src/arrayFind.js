/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { coerceArray } from './coerceArray';
import { DEFAULT_ID_KEY } from './defaultIDKey';
import { distinctUntilChanged, map } from 'rxjs/operators';
import { isArray } from './isArray';
import { isFunction } from './isFunction';
import { isEmpty } from './isEmpty';
// @internal
/**
 * @template T
 * @param {?} collection
 * @param {?} idsOrPredicate
 * @param {?} idKey
 * @return {?}
 */
export function find(collection, idsOrPredicate, idKey) {
    var e_1, _a, e_2, _b;
    /** @type {?} */
    var result = [];
    if (isFunction(idsOrPredicate)) {
        try {
            for (var collection_1 = tslib_1.__values(collection), collection_1_1 = collection_1.next(); !collection_1_1.done; collection_1_1 = collection_1.next()) {
                var entity = collection_1_1.value;
                if (idsOrPredicate(entity) === true) {
                    result.push(entity);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (collection_1_1 && !collection_1_1.done && (_a = collection_1.return)) _a.call(collection_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
    }
    else {
        /** @type {?} */
        var toSet = coerceArray(idsOrPredicate).reduce((/**
         * @param {?} acc
         * @param {?} current
         * @return {?}
         */
        function (acc, current) { return acc.add(current); }), new Set());
        try {
            for (var collection_2 = tslib_1.__values(collection), collection_2_1 = collection_2.next(); !collection_2_1.done; collection_2_1 = collection_2.next()) {
                var entity = collection_2_1.value;
                if (toSet.has(entity[idKey])) {
                    result.push(entity);
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (collection_2_1 && !collection_2_1.done && (_b = collection_2.return)) _b.call(collection_2);
            }
            finally { if (e_2) throw e_2.error; }
        }
    }
    return result;
}
// @internal
/**
 * @template T
 * @return {?}
 */
export function distinctUntilArrayItemChanged() {
    return distinctUntilChanged((/**
     * @param {?} prevCollection
     * @param {?} currentCollection
     * @return {?}
     */
    function (prevCollection, currentCollection) {
        if (prevCollection === currentCollection) {
            return true;
        }
        if (isArray(prevCollection) === false || isArray(currentCollection) === false) {
            return false;
        }
        if (isEmpty(prevCollection) && isEmpty(currentCollection)) {
            return true;
        }
        // if item is new in the current collection but not exist in the prev collection
        /** @type {?} */
        var hasNewItem = hasChange(currentCollection, prevCollection);
        if (hasNewItem) {
            return false;
        }
        /** @type {?} */
        var isOneOfItemReferenceChanged = hasChange(prevCollection, currentCollection);
        // return false means there is a change and we want to call next()
        return isOneOfItemReferenceChanged === false;
    }));
}
// @internal
/**
 * @template T
 * @param {?} first
 * @param {?} second
 * @return {?}
 */
function hasChange(first, second) {
    /** @type {?} */
    var hasChange = second.some((/**
     * @param {?} currentItem
     * @return {?}
     */
    function (currentItem) {
        /** @type {?} */
        var oldItem = first.find((/**
         * @param {?} prevItem
         * @return {?}
         */
        function (prevItem) { return prevItem === currentItem; }));
        return oldItem === undefined;
    }));
    return hasChange;
}
/**
 * @template T
 * @param {?} idsOrPredicate
 * @param {?=} idKey
 * @return {?}
 */
export function arrayFind(idsOrPredicate, idKey) {
    return (/**
     * @param {?} source
     * @return {?}
     */
    function (source) {
        return source.pipe(map((/**
         * @param {?} collection
         * @return {?}
         */
        function (collection) {
            // which means the user deleted the root entity or set the collection to nil
            if (isArray(collection) === false) {
                return collection;
            }
            return find(collection, idsOrPredicate, idKey || DEFAULT_ID_KEY);
        })), distinctUntilArrayItemChanged(), map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (isArray(value) === false) {
                return value;
            }
            if (isArray(idsOrPredicate) || isFunction(idsOrPredicate)) {
                return value;
            }
            return value[0];
        })));
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJyYXlGaW5kLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGRhdG9yYW1hL2FraXRhLyIsInNvdXJjZXMiOlsic3JjL2FycmF5RmluZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQzs7Ozs7Ozs7O0FBR3BDLE1BQU0sVUFBVSxJQUFJLENBQUksVUFBZSxFQUFFLGNBQW1DLEVBQUUsS0FBYTs7O1FBQ25GLE1BQU0sR0FBRyxFQUFFO0lBQ2pCLElBQUksVUFBVSxDQUFDLGNBQWMsQ0FBQyxFQUFFOztZQUM5QixLQUFxQixJQUFBLGVBQUEsaUJBQUEsVUFBVSxDQUFBLHNDQUFBLDhEQUFFO2dCQUE1QixJQUFNLE1BQU0sdUJBQUE7Z0JBQ2YsSUFBSSxjQUFjLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxFQUFFO29CQUNuQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUNyQjthQUNGOzs7Ozs7Ozs7S0FDRjtTQUFNOztZQUNDLEtBQUssR0FBRyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTTs7Ozs7UUFBQyxVQUFDLEdBQUcsRUFBRSxPQUFPLElBQUssT0FBQSxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFoQixDQUFnQixHQUFFLElBQUksR0FBRyxFQUFFLENBQUM7O1lBRS9GLEtBQXFCLElBQUEsZUFBQSxpQkFBQSxVQUFVLENBQUEsc0NBQUEsOERBQUU7Z0JBQTVCLElBQU0sTUFBTSx1QkFBQTtnQkFDZixJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0JBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7aUJBQ3JCO2FBQ0Y7Ozs7Ozs7OztLQUNGO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQzs7Ozs7O0FBR0QsTUFBTSxVQUFVLDZCQUE2QjtJQUMzQyxPQUFPLG9CQUFvQjs7Ozs7SUFBQyxVQUFDLGNBQW1CLEVBQUUsaUJBQXNCO1FBQ3RFLElBQUksY0FBYyxLQUFLLGlCQUFpQixFQUFFO1lBQ3hDLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxLQUFLLElBQUksT0FBTyxDQUFDLGlCQUFpQixDQUFDLEtBQUssS0FBSyxFQUFFO1lBQzdFLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsaUJBQWlCLENBQUMsRUFBRTtZQUN6RCxPQUFPLElBQUksQ0FBQztTQUNiOzs7WUFHSyxVQUFVLEdBQUcsU0FBUyxDQUFDLGlCQUFpQixFQUFFLGNBQWMsQ0FBQztRQUUvRCxJQUFJLFVBQVUsRUFBRTtZQUNkLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7O1lBRUssMkJBQTJCLEdBQUcsU0FBUyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQztRQUVoRixrRUFBa0U7UUFDbEUsT0FBTywyQkFBMkIsS0FBSyxLQUFLLENBQUM7SUFDL0MsQ0FBQyxFQUFDLENBQUM7QUFDTCxDQUFDOzs7Ozs7OztBQUdELFNBQVMsU0FBUyxDQUFJLEtBQVUsRUFBRSxNQUFXOztRQUNyQyxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUk7Ozs7SUFBQyxVQUFBLFdBQVc7O1lBQ2pDLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSTs7OztRQUFDLFVBQUEsUUFBUSxJQUFJLE9BQUEsUUFBUSxLQUFLLFdBQVcsRUFBeEIsQ0FBd0IsRUFBQztRQUNoRSxPQUFPLE9BQU8sS0FBSyxTQUFTLENBQUM7SUFDL0IsQ0FBQyxFQUFDO0lBRUYsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQzs7Ozs7OztBQTRCRCxNQUFNLFVBQVUsU0FBUyxDQUFJLGNBQTRDLEVBQUUsS0FBYztJQUN2Rjs7OztJQUFPLFVBQVMsTUFBdUI7UUFDckMsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUNoQixHQUFHOzs7O1FBQUMsVUFBQyxVQUFrQztZQUNyQyw0RUFBNEU7WUFDNUUsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssS0FBSyxFQUFFO2dCQUNqQyxPQUFPLFVBQVUsQ0FBQzthQUNuQjtZQUNELE9BQU8sSUFBSSxDQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUUsS0FBSyxJQUFJLGNBQWMsQ0FBQyxDQUFDO1FBQ25FLENBQUMsRUFBQyxFQUNGLDZCQUE2QixFQUFFLEVBQy9CLEdBQUc7Ozs7UUFBQyxVQUFBLEtBQUs7WUFDUCxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLEVBQUU7Z0JBQzVCLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7WUFFRCxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxVQUFVLENBQUMsY0FBYyxDQUFDLEVBQUU7Z0JBQ3pELE9BQU8sS0FBSyxDQUFDO2FBQ2Q7WUFFRCxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQyxFQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElELCBJRFMsIEl0ZW1QcmVkaWNhdGUgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IGNvZXJjZUFycmF5IH0gZnJvbSAnLi9jb2VyY2VBcnJheSc7XG5pbXBvcnQgeyBERUZBVUxUX0lEX0tFWSB9IGZyb20gJy4vZGVmYXVsdElES2V5JztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb24sIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGlzQXJyYXkgfSBmcm9tICcuL2lzQXJyYXknO1xuaW1wb3J0IHsgaXNGdW5jdGlvbiB9IGZyb20gJy4vaXNGdW5jdGlvbic7XG5pbXBvcnQgeyBpc0VtcHR5IH0gZnJvbSAnLi9pc0VtcHR5JztcblxuLy8gQGludGVybmFsXG5leHBvcnQgZnVuY3Rpb24gZmluZDxUPihjb2xsZWN0aW9uOiBUW10sIGlkc09yUHJlZGljYXRlOiBJRFMgfCBJdGVtUHJlZGljYXRlLCBpZEtleTogc3RyaW5nKSB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBpZiAoaXNGdW5jdGlvbihpZHNPclByZWRpY2F0ZSkpIHtcbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBjb2xsZWN0aW9uKSB7XG4gICAgICBpZiAoaWRzT3JQcmVkaWNhdGUoZW50aXR5KSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXN1bHQucHVzaChlbnRpdHkpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCB0b1NldCA9IGNvZXJjZUFycmF5KGlkc09yUHJlZGljYXRlKS5yZWR1Y2UoKGFjYywgY3VycmVudCkgPT4gYWNjLmFkZChjdXJyZW50KSwgbmV3IFNldCgpKTtcblxuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIGNvbGxlY3Rpb24pIHtcbiAgICAgIGlmICh0b1NldC5oYXMoZW50aXR5W2lkS2V5XSkpIHtcbiAgICAgICAgcmVzdWx0LnB1c2goZW50aXR5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyBAaW50ZXJuYWxcbmV4cG9ydCBmdW5jdGlvbiBkaXN0aW5jdFVudGlsQXJyYXlJdGVtQ2hhbmdlZDxUPigpOiBNb25vVHlwZU9wZXJhdG9yRnVuY3Rpb248VFtdPiB7XG4gIHJldHVybiBkaXN0aW5jdFVudGlsQ2hhbmdlZCgocHJldkNvbGxlY3Rpb246IFRbXSwgY3VycmVudENvbGxlY3Rpb246IFRbXSkgPT4ge1xuICAgIGlmIChwcmV2Q29sbGVjdGlvbiA9PT0gY3VycmVudENvbGxlY3Rpb24pIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChpc0FycmF5KHByZXZDb2xsZWN0aW9uKSA9PT0gZmFsc2UgfHwgaXNBcnJheShjdXJyZW50Q29sbGVjdGlvbikgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGlzRW1wdHkocHJldkNvbGxlY3Rpb24pICYmIGlzRW1wdHkoY3VycmVudENvbGxlY3Rpb24pKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBpZiBpdGVtIGlzIG5ldyBpbiB0aGUgY3VycmVudCBjb2xsZWN0aW9uIGJ1dCBub3QgZXhpc3QgaW4gdGhlIHByZXYgY29sbGVjdGlvblxuICAgIGNvbnN0IGhhc05ld0l0ZW0gPSBoYXNDaGFuZ2UoY3VycmVudENvbGxlY3Rpb24sIHByZXZDb2xsZWN0aW9uKTtcblxuICAgIGlmIChoYXNOZXdJdGVtKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgaXNPbmVPZkl0ZW1SZWZlcmVuY2VDaGFuZ2VkID0gaGFzQ2hhbmdlKHByZXZDb2xsZWN0aW9uLCBjdXJyZW50Q29sbGVjdGlvbik7XG5cbiAgICAvLyByZXR1cm4gZmFsc2UgbWVhbnMgdGhlcmUgaXMgYSBjaGFuZ2UgYW5kIHdlIHdhbnQgdG8gY2FsbCBuZXh0KClcbiAgICByZXR1cm4gaXNPbmVPZkl0ZW1SZWZlcmVuY2VDaGFuZ2VkID09PSBmYWxzZTtcbiAgfSk7XG59XG5cbi8vIEBpbnRlcm5hbFxuZnVuY3Rpb24gaGFzQ2hhbmdlPFQ+KGZpcnN0OiBUW10sIHNlY29uZDogVFtdKSB7XG4gIGNvbnN0IGhhc0NoYW5nZSA9IHNlY29uZC5zb21lKGN1cnJlbnRJdGVtID0+IHtcbiAgICBjb25zdCBvbGRJdGVtID0gZmlyc3QuZmluZChwcmV2SXRlbSA9PiBwcmV2SXRlbSA9PT0gY3VycmVudEl0ZW0pO1xuICAgIHJldHVybiBvbGRJdGVtID09PSB1bmRlZmluZWQ7XG4gIH0pO1xuXG4gIHJldHVybiBoYXNDaGFuZ2U7XG59XG5cbi8qKlxuICogRmluZCBpdGVtcyBpbiBhIGNvbGxlY3Rpb25cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICBzZWxlY3RFbnRpdHkoMSwgJ2NvbW1lbnRzJykucGlwZShcbiAqICAgYXJyYXlGaW5kKGNvbW1lbnQgPT4gY29tbWVudC50ZXh0ID0gJ3RleHQnKVxuICogKVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXJyYXlGaW5kPFQ+KGlkczogSXRlbVByZWRpY2F0ZTxUPiwgaWRLZXk/OiBuZXZlcik6IChzb3VyY2U6IE9ic2VydmFibGU8VFtdPikgPT4gT2JzZXJ2YWJsZTxUW10+O1xuLyoqXG4gKiBAZXhhbXBsZVxuICpcbiAqIHNlbGVjdEVudGl0eSgxLCAnY29tbWVudHMnKS5waXBlKFxuICogICBhcnJheUZpbmQoMylcbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFycmF5RmluZDxUPihpZHM6IElELCBpZEtleT86IHN0cmluZyk6IChzb3VyY2U6IE9ic2VydmFibGU8VFtdPikgPT4gT2JzZXJ2YWJsZTxUPjtcbi8qKlxuICogQGV4YW1wbGVcbiAqXG4gKiBzZWxlY3RFbnRpdHkoMSwgJ2NvbW1lbnRzJykucGlwZShcbiAqICAgYXJyYXlGaW5kKFsxLCAyLCAzXSlcbiAqIClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFycmF5RmluZDxUPihpZHM6IElEW10sIGlkS2V5Pzogc3RyaW5nKTogKHNvdXJjZTogT2JzZXJ2YWJsZTxUW10+KSA9PiBPYnNlcnZhYmxlPFRbXT47XG5leHBvcnQgZnVuY3Rpb24gYXJyYXlGaW5kPFQ+KGlkc09yUHJlZGljYXRlOiBJRFtdIHwgSUQgfCBJdGVtUHJlZGljYXRlPFQ+LCBpZEtleT86IHN0cmluZyk6IChzb3VyY2U6IE9ic2VydmFibGU8VFtdPikgPT4gT2JzZXJ2YWJsZTxUW10gfCBUPiB7XG4gIHJldHVybiBmdW5jdGlvbihzb3VyY2U6IE9ic2VydmFibGU8VFtdPikge1xuICAgIHJldHVybiBzb3VyY2UucGlwZShcbiAgICAgIG1hcCgoY29sbGVjdGlvbjogVFtdIHwgdW5kZWZpbmVkIHwgbnVsbCkgPT4ge1xuICAgICAgICAvLyB3aGljaCBtZWFucyB0aGUgdXNlciBkZWxldGVkIHRoZSByb290IGVudGl0eSBvciBzZXQgdGhlIGNvbGxlY3Rpb24gdG8gbmlsXG4gICAgICAgIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaW5kKGNvbGxlY3Rpb24sIGlkc09yUHJlZGljYXRlLCBpZEtleSB8fCBERUZBVUxUX0lEX0tFWSk7XG4gICAgICB9KSxcbiAgICAgIGRpc3RpbmN0VW50aWxBcnJheUl0ZW1DaGFuZ2VkKCksXG4gICAgICBtYXAodmFsdWUgPT4ge1xuICAgICAgICBpZiAoaXNBcnJheSh2YWx1ZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzQXJyYXkoaWRzT3JQcmVkaWNhdGUpIHx8IGlzRnVuY3Rpb24oaWRzT3JQcmVkaWNhdGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlWzBdO1xuICAgICAgfSlcbiAgICApO1xuICB9O1xufVxuIl19