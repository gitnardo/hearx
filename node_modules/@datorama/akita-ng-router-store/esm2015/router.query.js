import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { RouterStore } from './router.store';
import { Query, filterNil } from '@datorama/akita';
import { combineLatest } from 'rxjs';
import { map, pluck, distinctUntilChanged } from 'rxjs/operators';
function slice(section) {
    return (source) => {
        return source.pipe(map(data => data.state)).pipe(filterNil, map(state => state.root[section]));
    };
}
let RouterQuery = class RouterQuery extends Query {
    constructor(store) {
        super(store);
        this.store = store;
    }
    selectParams(names) {
        if (names === undefined) {
            return this.select().pipe(slice('params'), distinctUntilChanged());
        }
        const select = (p) => this.select().pipe(slice('params'), pluck(p), distinctUntilChanged());
        if (Array.isArray(names)) {
            const sources = names.map(select);
            return combineLatest(sources);
        }
        return select(names).pipe(distinctUntilChanged());
    }
    getParams(name) {
        if (this.getValue().state) {
            const params = this.getValue().state.root.params;
            if (name === undefined) {
                return params;
            }
            return params[name];
        }
        return null;
    }
    selectQueryParams(names) {
        if (names === undefined) {
            return this.select().pipe(slice('queryParams'), distinctUntilChanged());
        }
        const select = (p) => this.select().pipe(slice('queryParams'), pluck(p), distinctUntilChanged());
        if (Array.isArray(names)) {
            const sources = names.map(select);
            return combineLatest(sources);
        }
        return select(names);
    }
    getQueryParams(name) {
        if (this.getValue().state) {
            const params = this.getValue().state.root.queryParams;
            if (name === undefined) {
                return params;
            }
            return params[name];
        }
        return null;
    }
    selectFragment() {
        return this.select().pipe(slice('fragment'), distinctUntilChanged());
    }
    getFragment() {
        if (this.getValue().state) {
            return this.getValue().state.root.fragment;
        }
        return null;
    }
    selectData(name) {
        if (name === undefined) {
            return this.select().pipe(slice('data'), distinctUntilChanged());
        }
        return this.select().pipe(slice('data'), pluck(name), distinctUntilChanged());
    }
    getData(name) {
        if (this.getValue().state) {
            const data = this.getValue().state.root.data;
            if (name === undefined) {
                return data;
            }
            return data[name];
        }
        return null;
    }
};
RouterQuery = tslib_1.__decorate([
    Injectable(),
    tslib_1.__metadata("design:paramtypes", [RouterStore])
], RouterQuery);
export { RouterQuery };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGVyLnF1ZXJ5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGRhdG9yYW1hL2FraXRhLW5nLXJvdXRlci1zdG9yZS8iLCJzb3VyY2VzIjpbInJvdXRlci5xdWVyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsV0FBVyxFQUFlLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUQsT0FBTyxFQUFFLEtBQUssRUFBVyxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RCxPQUFPLEVBQWMsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHbEUsU0FBUyxLQUFLLENBQUMsT0FBZTtJQUM1QixPQUFPLENBQUMsTUFBb0QsRUFBRSxFQUFFO1FBQzlELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQzlDLFNBQVMsRUFDVCxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBRSxLQUFNLENBQUMsSUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQzVDLENBQUM7SUFDSixDQUFDLENBQUM7QUFDSixDQUFDO0FBR0QsSUFBYSxXQUFXLEdBQXhCLE1BQWEsV0FBWSxTQUFRLEtBQWtCO0lBQ2pELFlBQXNCLEtBQWtCO1FBQ3RDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQURPLFVBQUssR0FBTCxLQUFLLENBQWE7SUFFeEMsQ0FBQztJQUtELFlBQVksQ0FBSSxLQUF5QjtRQUN2QyxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDdkIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENB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QUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxvQkFBb0IsRUFBRSxDQUFDLENBQUM7U0FDbEU7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQ3ZCLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDYixLQUFLLENBQUMsSUFBSSxDQUFDLEVBQ1gsb0JBQW9CLEVBQUUsQ0FDdkIsQ0FBQztJQUNKLENBQUM7SUFJRCxPQUFPLENBQUksSUFBYTtRQUN0QixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUU7WUFDekIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzlDLElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRTtnQkFDdEIsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUVELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ25CO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQTtBQXpIWSxXQUFXO0lBRHZCLFVBQVUsRUFBRTs2Q0FFa0IsV0FBVztHQUQ3QixXQUFXLENBeUh2QjtTQXpIWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyU3RvcmUsIFJvdXRlclN0YXRlIH0gZnJvbSAnLi9yb3V0ZXIuc3RvcmUnO1xuaW1wb3J0IHsgUXVlcnksIEhhc2hNYXAsIGZpbHRlck5pbCB9IGZyb20gJ0BkYXRvcmFtYS9ha2l0YSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHBsdWNrLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFJvdXRlclN0YXRlU25hcHNob3QsIERhdGEgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuXG5mdW5jdGlvbiBzbGljZShzZWN0aW9uOiBzdHJpbmcpIHtcbiAgcmV0dXJuIChzb3VyY2U6IE9ic2VydmFibGU8Um91dGVyU3RhdGU8Um91dGVyU3RhdGVTbmFwc2hvdD4+KSA9PiB7XG4gICAgcmV0dXJuIHNvdXJjZS5waXBlKG1hcChkYXRhID0+IGRhdGEuc3RhdGUpKS5waXBlKFxuICAgICAgZmlsdGVyTmlsLFxuICAgICAgbWFwKHN0YXRlID0+IChzdGF0ZSEucm9vdCBhcyBhbnkpW3NlY3Rpb25dKVxuICAgICk7XG4gIH07XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSb3V0ZXJRdWVyeSBleHRlbmRzIFF1ZXJ5PFJvdXRlclN0YXRlPiB7XG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBzdG9yZTogUm91dGVyU3RvcmUpIHtcbiAgICBzdXBlcihzdG9yZSk7XG4gIH1cblxuICBzZWxlY3RQYXJhbXM8VD4obmFtZXM6IHN0cmluZyk6IE9ic2VydmFibGU8VD47XG4gIHNlbGVjdFBhcmFtczxUPihuYW1lczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFRbXT47XG4gIHNlbGVjdFBhcmFtczxUPigpOiBPYnNlcnZhYmxlPEhhc2hNYXA8VD4+O1xuICBzZWxlY3RQYXJhbXM8VD4obmFtZXM/OiBzdHJpbmcgfCBzdHJpbmdbXSk6IE9ic2VydmFibGU8VCB8IFRbXSB8IEhhc2hNYXA8VD4+IHtcbiAgICBpZiAobmFtZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0KCkucGlwZShzbGljZSgncGFyYW1zJyksIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpO1xuICAgIH1cblxuICAgIGNvbnN0IHNlbGVjdCA9IChwOiBzdHJpbmcpID0+XG4gICAgICB0aGlzLnNlbGVjdCgpLnBpcGUoXG4gICAgICAgIHNsaWNlKCdwYXJhbXMnKSxcbiAgICAgICAgcGx1Y2socCksXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgICk7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykpIHtcbiAgICAgIGNvbnN0IHNvdXJjZXMgPSBuYW1lcy5tYXAoc2VsZWN0KTtcbiAgICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KHNvdXJjZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3QobmFtZXMpLnBpcGUoZGlzdGluY3RVbnRpbENoYW5nZWQoKSk7XG4gIH1cblxuICBnZXRQYXJhbXM8VD4oKTogSGFzaE1hcDxUPjtcbiAgZ2V0UGFyYW1zPFQ+KG5hbWU6IHN0cmluZyk6IFQ7XG4gIGdldFBhcmFtczxUPihuYW1lPzogc3RyaW5nKTogVCB8IEhhc2hNYXA8YW55PiB8IG51bGwge1xuICAgIGlmICh0aGlzLmdldFZhbHVlKCkuc3RhdGUpIHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMuZ2V0VmFsdWUoKS5zdGF0ZSEucm9vdC5wYXJhbXM7XG4gICAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwYXJhbXNbbmFtZV07XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBzZWxlY3RRdWVyeVBhcmFtczxUPihuYW1lczogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPjtcbiAgc2VsZWN0UXVlcnlQYXJhbXM8VD4obmFtZXM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxUW10+O1xuICBzZWxlY3RRdWVyeVBhcmFtczxUPigpOiBPYnNlcnZhYmxlPEhhc2hNYXA8VD4+O1xuICBzZWxlY3RRdWVyeVBhcmFtczxUPihuYW1lcz86IHN0cmluZyB8IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxUIHwgVFtdIHwgSGFzaE1hcDxUPj4ge1xuICAgIGlmIChuYW1lcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3QoKS5waXBlKHNsaWNlKCdxdWVyeVBhcmFtcycpLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpKTtcbiAgICB9XG5cbiAgICBjb25zdCBzZWxlY3QgPSAocDogc3RyaW5nKSA9PlxuICAgICAgdGhpcy5zZWxlY3QoKS5waXBlKFxuICAgICAgICBzbGljZSgncXVlcnlQYXJhbXMnKSxcbiAgICAgICAgcGx1Y2socCksXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICAgICk7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykpIHtcbiAgICAgIGNvbnN0IHNvdXJjZXMgPSBuYW1lcy5tYXAoc2VsZWN0KTtcbiAgICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KHNvdXJjZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3QobmFtZXMpO1xuICB9XG5cbiAgZ2V0UXVlcnlQYXJhbXM8VD4obmFtZTogc3RyaW5nKTogVDtcbiAgZ2V0UXVlcnlQYXJhbXM8VD4oKTogSGFzaE1hcDxUPjtcbiAgZ2V0UXVlcnlQYXJhbXM8VD4obmFtZT86IHN0cmluZyk6IFQgfCBIYXNoTWFwPFQ+IHwgbnVsbCB7XG4gICAgaWYgKHRoaXMuZ2V0VmFsdWUoKS5zdGF0ZSkge1xuICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5nZXRWYWx1ZSgpLnN0YXRlIS5yb290LnF1ZXJ5UGFyYW1zO1xuICAgICAgaWYgKG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGFyYW1zW25hbWVdO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc2VsZWN0RnJhZ21lbnQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3QoKS5waXBlKHNsaWNlKCdmcmFnbWVudCcpLCBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpKTtcbiAgfVxuXG4gIGdldEZyYWdtZW50KCk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICh0aGlzLmdldFZhbHVlKCkuc3RhdGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKCkuc3RhdGUhLnJvb3QuZnJhZ21lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBzZWxlY3REYXRhPFQ+KG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8VD47XG4gIHNlbGVjdERhdGE8VD4oKTogT2JzZXJ2YWJsZTxIYXNoTWFwPFQ+PjtcbiAgc2VsZWN0RGF0YTxUPihuYW1lPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUIHwgSGFzaE1hcDxUPj4ge1xuICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdCgpLnBpcGUoc2xpY2UoJ2RhdGEnKSwgZGlzdGluY3RVbnRpbENoYW5nZWQoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0KCkucGlwZShcbiAgICAgIHNsaWNlKCdkYXRhJyksXG4gICAgICBwbHVjayhuYW1lKSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICApO1xuICB9XG5cbiAgZ2V0RGF0YTxUPihuYW1lOiBzdHJpbmcpOiBUIHwgbnVsbDtcbiAgZ2V0RGF0YTxUPigpOiBEYXRhIHwgbnVsbDtcbiAgZ2V0RGF0YTxUPihuYW1lPzogc3RyaW5nKTogRGF0YSB8IG51bGwge1xuICAgIGlmICh0aGlzLmdldFZhbHVlKCkuc3RhdGUpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldFZhbHVlKCkuc3RhdGUhLnJvb3QuZGF0YTtcbiAgICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkYXRhW25hbWVdO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXX0=