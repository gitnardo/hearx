!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@datorama/akita"),require("@angular/router"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@datorama/akita-ng-router-store",["exports","@angular/core","@datorama/akita","@angular/router","rxjs","rxjs/operators"],e):e(((t=t||self).datorama=t.datorama||{},t.datorama["akita-ng-router-store"]={}),t.ng.core,t.akita,t.ng.router,t.rxjs,t.rxjs.operators)}(this,function(t,e,r,n,o,i){"use strict";var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function p(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function d(){return{state:null,navigationId:null}}var l=function(t){function n(){return t.call(this,{state:null,navigationId:null})||this}return u(n,t),n.ngInjectableDef=e.defineInjectable({factory:function(){return new n},token:n,providedIn:"root"}),n=p([e.Injectable({providedIn:"root"}),r.StoreConfig({name:"router"}),c("design:paramtypes",[])],n)}(r.Store);function f(t){return function(e){return e.pipe(i.map(function(t){return t.state})).pipe(r.filterNil,i.map(function(e){return e.root[t]}))}}var g=function(t){function r(e){var r=t.call(this,e)||this;return r.store=e,r}return u(r,t),r.prototype.selectParams=function(t){var e=this;if(t===undefined)return this.select().pipe(f("params"),i.distinctUntilChanged());var r=function(t){return e.select().pipe(f("params"),i.pluck(t),i.distinctUntilChanged())};if(Array.isArray(t)){var n=t.map(r);return o.combineLatest(n)}return r(t).pipe(i.distinctUntilChanged())},r.prototype.getParams=function(t){if(this.getValue().state){var e=this.getValue().state.root.params;return t===undefined?e:e[t]}return null},r.prototype.selectQueryParams=function(t){var e=this;if(t===undefined)return this.select().pipe(f("queryParams"),i.distinctUntilChanged());var r=function(t){return e.select().pipe(f("queryParams"),i.pluck(t),i.distinctUntilChanged())};if(Array.isArray(t)){var n=t.map(r);return o.combineLatest(n)}return r(t)},r.prototype.getQueryParams=function(t){if(this.getValue().state){var e=this.getValue().state.root.queryParams;return t===undefined?e:e[t]}return null},r.prototype.selectFragment=function(){return this.select().pipe(f("fragment"),i.distinctUntilChanged())},r.prototype.getFragment=function(){return this.getValue().state?this.getValue().state.root.fragment:null},r.prototype.selectData=function(t){return t===undefined?this.select().pipe(f("data"),i.distinctUntilChanged()):this.select().pipe(f("data"),i.pluck(t),i.distinctUntilChanged())},r.prototype.getData=function(t){if(this.getValue().state){var e=this.getValue().state.root.data;return t===undefined?e:e[t]}return null},r=p([e.Injectable(),c("design:paramtypes",[l])],r)}(r.Query),h=function(){function t(t,e,r){this.routerStore=t,this.routerQuery=e,this.router=r,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}return t.prototype.dispatchRouterCancel=function(t){this.update()},t.prototype.dispatchRouterError=function(t){this.update()},t.prototype.dispatchRouterNavigation=function(){this.update()},t.prototype.init=function(){this.setUpRouterHook(),this.setUpStoreListener(),this.setUpStateRollbackEvents()},t.prototype.update=function(){var t=this;this.dispatchTriggeredByRouter=!0,this.routerStore.update(function(e){return s({},e,{state:t.routerStateSnapshot,navigationId:t.lastRoutesRecognized?t.lastRoutesRecognized.id:null})}),this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1},t.prototype.setUpRouterHook=function(){var t=this;this.router.hooks.beforePreactivation=function(e){return t.routerStateSnapshot={root:t.serializeRoute(e.root),url:e.url},t.shouldDispatchRouterNavigation()&&t.dispatchRouterNavigation(),o.of(!0)}},t.prototype.setUpStoreListener=function(){var t=this;this.routerQuery.select(function(t){return t}).subscribe(function(e){t.routerState=e,t.navigateIfNeeded()})},t.prototype.shouldDispatchRouterNavigation=function(){return!this.routerState||!this.navigationTriggeredByDispatch},t.prototype.navigateIfNeeded=function(){this.routerState&&this.routerState.state&&(this.dispatchTriggeredByRouter||this.router.url!==this.routerState.state.url&&(this.navigationTriggeredByDispatch=!0,r.setSkipAction(),this.router.navigateByUrl(this.routerState.state.url)))},t.prototype.setUpStateRollbackEvents=function(){var t=this;this.router.events.subscribe(function(e){e instanceof n.RoutesRecognized?t.lastRoutesRecognized=e:e instanceof n.NavigationCancel?t.dispatchRouterCancel(e):e instanceof n.NavigationError&&t.dispatchRouterError(e)})},t.prototype.serializeRoute=function(t){for(var e=t.root;e.firstChild;)e=e.firstChild;var r=e.params,n=e.data,o=e.paramMap,i=e.queryParamMap,a=e.queryParams,u=e.fragment;return{url:t.url,params:r,queryParams:a,fragment:u,data:n,paramMap:o,queryParamMap:i}},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t(e.inject(l),e.inject(g),e.inject(n.Router))},token:t,providedIn:"root"}),p([r.action("Navigation Cancelled"),c("design:type",Function),c("design:paramtypes",[n.NavigationCancel]),c("design:returntype",void 0)],t.prototype,"dispatchRouterCancel",null),p([r.action("Navigation Error"),c("design:type",Function),c("design:paramtypes",[n.NavigationError]),c("design:returntype",void 0)],t.prototype,"dispatchRouterError",null),p([r.action("Navigation"),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],t.prototype,"dispatchRouterNavigation",null),t=p([e.Injectable({providedIn:"root"}),c("design:paramtypes",[l,g,n.Router])],t)}(),y=function(){function t(t){this.routerService=t,this.routerService.init()}var r;return r=t,t.forRoot=function(){return{ngModule:r,providers:[l,h,g]}},t=r=p([e.NgModule({}),c("design:paramtypes",[h])],t)}();t.AkitaNgRouterStoreModule=y,t.RouterQuery=g,t.RouterService=h,t.RouterStore=l,t.createInitialRouterState=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=datorama-akita-ng-router-store.umd.min.js.map