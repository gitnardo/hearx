!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@datorama/akita"),require("rxjs"),require("@angular/core"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@datorama/akita-ng-entity-service",["exports","@datorama/akita","rxjs","@angular/core","@angular/common/http","rxjs/operators"],e):e(((t=t||self).datorama=t.datorama||{},t.datorama["akita-ng-entity-service"]={}),t.akita,t.rxjs,t.ng.core,t.ng.common.http,t.rxjs.operators)}(this,(function(t,e,r,o,n,i){"use strict";var s={GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},a=function(){function t(){this.dispatcher=new r.Subject,this.action$=this.dispatcher.asObservable()}return t.prototype.dispatch=function(t){this.dispatcher.next(t)},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=o.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var c=function(){function t(){this.dispatcher=new r.Subject,this.loading$=this.dispatcher.asObservable()}return t.prototype.dispatch=function(t){this.dispatcher.next(t)},t.prototype.loadersFor=function(t){var r=this,o=i.filter((function(e){var r=e.storeName;return!t||r===t})),n=function(t){return i.filter((function(r){var o=r.method;return e.isFunction(t)?t(o):o===t}))},a=function(t){return r.loading$.pipe(o,n(t),i.map((function(t){return t.loading})))},c=function(t,e){return r.loading$.pipe(o,n(e),i.filter((function(e){return e.entityId===t})),i.map((function(t){return t.loading})))};return{get$:a(s.GET),add$:a(s.POST),update$:a((function(t){return t===s.PUT||t===s.PATCH})),delete$:a(s.DELETE),getEntity:function(t){return c(t,s.GET)},updateEntity:function(t){return c(t,(function(t){return t===s.PUT||t===s.PATCH}))},deleteEntity:function(t){return c(t,s.DELETE)}}},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=o.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var u=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},p=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t};var d=new o.InjectionToken("NgEntityServiceGlobalConfig"),f={httpMethods:{GET:s.GET,POST:s.POST,PATCH:s.PATCH,PUT:s.PUT,DELETE:s.DELETE}};function h(t){for(var r,o,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(!n.length)return t;var s=n.shift();if(e.isObject(t)&&e.isObject(s))for(var a in s)e.isObject(s[a])?(t[a]||Object.assign(t,((r={})[a]={},r)),h(t[a],s[a])):Object.assign(t,((o={})[a]=s[a],o));return h.apply(void 0,p([t],n))}function l(t){return e.isNumber(t)||e.isString(t)}function g(t,e){return function(r){var o=r.payload,n=r.method,i=r.successMsg;e.dispatch({type:"success",storeName:t,payload:o,method:n,successMsg:i})}}function m(t,e){return function(r){var o=r.payload,n=r.method,i=r.errorMsg;e.dispatch({type:"error",storeName:t,payload:o,method:n,errorMsg:i})}}var y,E=this&&this.__extends||(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(t){return i.map((function(e){return(t||{}).mapResponseFn?t.mapResponseFn(e):e}))},b=function(t){function u(e,r){void 0===r&&(r={});var i=t.call(this)||this;return i.store=e,i.config=r,i.globalConfig={},i.http=o.inject(n.HttpClient),i.loader=o.inject(c),i.notifier=o.inject(a),i.globalConfig=o.inject(d),i.mergedConfig=h(f,i.globalConfig,r),i.dispatchSuccess=g(i.store.storeName,i.notifier),i.dispatchError=m(i.store.storeName,i.notifier),i}return E(u,t),Object.defineProperty(u.prototype,"api",{get:function(){return(this.baseUrl||this.getConfigValue("baseUrl"))+"/"+this.resourceName},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"resourceName",{get:function(){return this.getConfigValue("resourceName")||this.store.storeName},enumerable:!0,configurable:!0}),u.prototype.setBaseUrl=function(t){this.baseUrl=t},u.prototype.getHttp=function(){return this.http},u.prototype.getConfig=function(){return this.mergedConfig},u.prototype.get=function(t,e){var r,o=this,n=l(t),a=(n?e:t)||{},c=this.getHttpMethod(s.GET);return r=a.url?a.url:n?this.api+"/"+t:this.api,this.loader.dispatch({method:c,loading:!0,entityId:n?t:null,storeName:this.store.storeName}),this.http[c.toLowerCase()](r,a).pipe(v(a),i.tap((function(e){n?o.store.upsert(t,e):a.append?o.store.add(e):a.upsert?o.store.upsertMany(e):o.store.set(e),o.dispatchSuccess({method:c,payload:e,successMsg:a.successMsg})})),i.catchError((function(t){return o.handleError(c,t,a.errorMsg)})),i.finalize((function(){o.loader.dispatch({method:c,loading:!1,storeName:o.store.storeName})})))},u.prototype.add=function(t,e){var r=this,o=this.getHttpMethod(s.POST);return this.loader.dispatch({method:o,loading:!0,storeName:this.store.storeName}),this.http[o.toLowerCase()](this.resolveUrl(e),t,e).pipe(v(e),i.tap((function(t){r.store.add(t,e),r.dispatchSuccess({method:o,payload:t,successMsg:e&&e.successMsg})})),i.catchError((function(t){return r.handleError(o,t,e&&e.errorMsg)})),i.finalize((function(){r.loader.dispatch({method:o,loading:!1,storeName:r.store.storeName})})))},u.prototype.update=function(t,e,r){var o=this,n=r&&r.method?r.method:this.getHttpMethod(s.PUT);return this.loader.dispatch({method:n,loading:!0,entityId:t,storeName:this.store.storeName}),this.http[n.toLocaleLowerCase()](this.resolveUrl(r,t),e,r).pipe(v(r),i.tap((function(e){o.store.update(t,e),o.dispatchSuccess({method:n,payload:e,successMsg:r&&r.successMsg})})),i.catchError((function(t){return o.handleError(n,t,r&&r.errorMsg)})),i.finalize((function(){o.loader.dispatch({method:n,loading:!1,entityId:t,storeName:o.store.storeName})})))},u.prototype.delete=function(t,e){var r=this,o=this.getHttpMethod(s.DELETE);return this.loader.dispatch({method:o,loading:!0,entityId:t,storeName:this.store.storeName}),this.http[o.toLowerCase()](this.resolveUrl(e,t),e).pipe(v(e),i.tap((function(n){r.store.remove(t),r.dispatchSuccess({method:o,payload:n,successMsg:e&&e.successMsg})})),i.catchError((function(t){return r.handleError(o,t,e&&e.errorMsg)})),i.finalize((function(){r.loader.dispatch({method:o,loading:!1,entityId:t,storeName:r.store.storeName})})))},u.prototype.getHttpMethod=function(t){return this.mergedConfig.httpMethods[t]},u.prototype.getConfigValue=function(t){return this.constructor[t]||this.mergedConfig[t]},u.prototype.resolveUrl=function(t,r){var o=(t||{}).url;return e.isDefined(r)?o||this.api+"/"+r:o||this.api},u.prototype.handleError=function(t,e,o){return this.dispatchError({method:t,errorMsg:o,payload:e}),r.throwError(e)},u}(e.EntityService);t.HttpMethod=s,t.NG_ENTITY_SERVICE_CONFIG=d,t.NgEntityService=b,t.NgEntityServiceConfig=function(t){return void 0===t&&(t={}),function(e){t.baseUrl&&(e.baseUrl=t.baseUrl),t.resourceName&&(e.resourceName=t.resourceName)}},t.NgEntityServiceLoader=c,t.NgEntityServiceNotifier=a,t.defaultConfig=f,t.errorAction=m,t.filterMethod=function(t){return i.filter((function(e){return e.method===t}))},t.filterStore=function(t){return i.filter((function(e){return e.storeName===t}))},t.isID=l,t.mapResponse=v,t.mergeDeep=h,t.ofType=function(t){return i.filter((function(e){return e.type===t}))},t.successAction=g,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=datorama-akita-ng-entity-service.umd.min.js.map